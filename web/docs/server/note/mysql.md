# MySQLè£œè¶³æƒ…å ±

## ãƒ¦ãƒ¼ã‚¶ã®ä½œæˆã«ã¤ã„ã¦

```
mysql> CREATE USER mysqluser@localhost IDENTIFIED by 'thepassword';
```

ã“ã‚Œã§ `-h` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä¼´ã‚ãªã„ `$ mysql -u mysqluser -p` ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ `thepassword` ã‚’å…¥åŠ›ã™ã‚Œã°ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚`-h` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã‚ãšã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã® MySQL ã«æ¥ç¶šã‚’è©¦ã¿ãŸå ´åˆã«ã¯ã€ï¼ˆãã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ãŸï¼‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ MySQL ã‚µãƒ¼ãƒé–“ã§ TCP/IP æ¥ç¶šã§ã¯ãªãã‚½ã‚±ãƒƒãƒˆ (UNIX Socket) ã«ã‚ˆã‚‹æ¥ç¶šãŒè¡Œã‚ã‚Œã¾ã™ã€‚

phpMyAdmin ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ãªå ´åˆã§ã‚‚ã€ãã® Web ã‚µãƒ¼ãƒã¨ MySQL ã‚µãƒ¼ãƒãŒåŒä¸€ã§ã‚ã‚Œã°ã€åˆ©ç”¨ã™ã‚‹ MySQL ãƒ¦ãƒ¼ã‚¶ã®ãƒ›ã‚¹ãƒˆã‚’ localhost ã¨ã—ã¦ãŠã‘ã°æ¥ç¶šã§ãã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ä½œæˆæ™‚ã®ãƒ›ã‚¹ãƒˆéƒ¨æŒ‡å®šã«ã¤ã„ã¦ã€MySQL ã«æ¥ç¶šã‚’è¡Œã†ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒãŒåŒä¸€ã‚µãƒ¼ãƒã§ã‚ã£ã¦ã‚‚ã€localhost ã«å¯¾ã—ã¦ã‚½ã‚±ãƒƒãƒˆæ¥ç¶šã‚’è¡Œã†ã®ã‹ã€127.0.0.1 ã«å¯¾ã—ã¦ TCP/IP æ¥ç¶šã‚’è¡Œã†ã®ã‹ã«ã‚ˆã£ã¦ãƒ­ã‚°ã‚¤ãƒ³ã®å¯å¦ãŒç•°ãªã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€`user@127.0.0.1` ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆã«ã¯ `$ mysql -u user -p` ã§ã¯ãƒ­ã‚°ã‚¤ãƒ³ã§ããšã€`$ mysql -h 127.0.0.1 -u user -p` ã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä¸€æ–¹ã€ãƒ›ã‚¹ãƒˆåã®åå‰è§£æ±ºãŒè¡Œã‚ã‚Œã‚‹å ´åˆï¼ˆ`--skip-name-resolve` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹ãªå ´åˆï¼‰ã€ãƒ›ã‚¹ãƒˆ 127.0.0.1 ã«å¯¾ã™ã‚‹ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ã¯ã€localhost ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ 127.0.0.1 ã«å¯¾ã™ã‚‹åå‰è§£æ±ºã«ã‚ˆã£ã¦é€†å¼•ãã§ localhost ãŒãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ãŸã‚ã§ã€ã“ã®ã“ã¨ã¯ MySQL ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

- MySQL :: MySQL 5.6 Reference Manual :: 5.1.3 Server Command Options
    - https://dev.mysql.com/doc/refman/5.6/en/server-options.html#option_mysqld_skip-name-resolve

ä½™è«‡ã§ã™ãŒã€127.0.0.1 ãŒ localhost ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹ä»•æ§˜ã«ã¤ã„ã¦ã€ãƒã‚°ã§ã¯ãªã„ã‹ã¨ã„ã†æŒ‡æ‘˜ãŒã•ã‚Œã¦ã„ã¾ã™ãŒã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¸ã®èª¬æ˜ã‚‚è¿½åŠ ã•ã‚Œãªã„ã¾ã¾ã“ã®ä»•æ§˜ã¯æ”¾ç½®ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

- MySQL Bugs: #68436: user@127.0.0.1 is authorized partly as user@localhost.
    - http://bugs.mysql.com/bug.php?id=68436

ãƒ¦ãƒ¼ã‚¶ã‚’ä½œæˆã—ãŸã‚‰ã€ç¶šã‘ã¦ root ãƒ¦ãƒ¼ã‚¶æ¨©é™ã§ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ã«æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã¯å…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ“ä½œæ¨©é™ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã®æ¨©é™ï¼‰ã‚’ä¸ãˆã¾ã™ã€‚

```
# æ¨©é™ã‚’ä»˜ã‘ã‚‹
mysql> GRANT ALL PRIVILEGES ON *.* TO mysqluser@localhost;

# æ¨©é™ã‚’å¤–ã™
mysql> REVOKE ALL PRIVILEGES ON *.* FROM mysqluser@localhost;
```

ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã«æ¨©é™ã‚’ä¸ãˆã¦ã—ã¾ã†ã¨ã€`mysql` ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç­‰ã®æ“ä½œã¾ã§ã§ãã¦ã—ã¾ã„ã¾ã™ã€‚ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã¿ã«æ¨©é™ã‚’ä¸ãˆã‚‹ãŸã‚ã«ã¯ã€ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã§ã¯ãªãå…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```
mysql> GRANT ALL PRIVILEGES ON test_db.* TO mysqluser@localhost;
```

ã“ã‚Œã§ `test_db` ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ“ä½œã™ã‚‹æ¨©é™ã‚’ä¸ãˆãŸã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ã«å¯¾ã™ã‚‹æ¨©é™ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åãŠã‚ˆã³ãƒ†ãƒ¼ãƒ–ãƒ«åã§ã¯ `_` ãŠã‚ˆã³ `%` ã®ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ãŒä½¿ç”¨ã§ãã¾ã™ã€‚

`_` ã¯ä»»æ„ã®1æ–‡å­—ã‚’è¡¨ã™ãŸã‚ã€ä¸Šè¨˜ã®è¨˜è¿°ã§ã¯ `testxdb` ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã§ãã¦ã—ã¾ã„ã¾ã™ã€‚ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‚’æ–‡å­—ã¨ã—ã¦æ‰±ã„ãŸã‘ã‚Œã°ã€ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç”¨ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
mysql> GRANT ALL PRIVILEGES ON `test\_db`.* TO mysqluser@localhost;
```

`%` ã¯ä»»æ„ã®0æ–‡å­—ä»¥ä¸Šã‚’è¡¨ã™ãŸã‚ã€`test_` ã‹ã‚‰å§‹ã¾ã‚‹åå‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã¿ä½œæˆã€å‰Šé™¤ã€æ“ä½œã‚’è‡ªç”±ã«è¡Œãˆã‚‹æ¨©é™ã‚’ä¸ãˆã‚‹ãŸã‚ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
mysql> GRANT ALL PRIVILEGES ON `test\_%`.* TO mysqluser@localhost;
```

- MySQL :: MySQL 5.6 Reference Manual :: 13.7.1.4 GRANT Syntax
    - https://dev.mysql.com/doc/refman/5.6/en/grant.html#grant-accounts-passwords

ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã®æ¨©é™ã¯ mysql.user ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç¢ºèªã§ãã¾ã™ã€‚ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®æ¨©é™ã¯ mysql.db ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç¢ºèªã§ãã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãŠã‚ˆã³ã€ãƒ¦ãƒ¼ã‚¶ã¸ã®æ¨©é™ã‚’ç¢ºèªã—ã¾ã™ã€‚

```
mysql> SELECT Host, User, Password FROM mysql.user;
mysql> SELECT * FROM mysql.user\G
mysql> SELECT * FROM mysql.db\G
```

ã‚‚ã—ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒç©ºã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Œã°ã€æ„å›³çš„ã§ãªã„é™ã‚Šå¿…ãšå…¨ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚root ãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã‚Šã—ãŸå ´åˆã«ã¯ã€ãã®å¾Œã§ MySQL ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚Ubuntu ã®å ´åˆã¯ MySQL ã®ã‚µãƒ¼ãƒ“ã‚¹åã¯ mysqld ã§ã¯ãªã mysql ã¨ãªã£ã¦ã„ã¾ã™ã€‚

```
mysql> UPDATE mysql.user SET password=PASSWORD('thepassword') where User='root';
```

```
$ sudo service mysql restart
```

## ç…§åˆé †åºã«ã¤ã„ã¦

- MySQL 5.7 æ™‚ç‚¹ã® utf8mb4 ã«é–¢ã™ã‚‹ Collation
    - utf8mb4_unicode_ci
    - utf8mb4_unicode_520_ci
    - utf8mb4_general_ci
    - utf8mb4_bin
- Case-Sensitive ã¨ Case-Insensitive ã‚’è©•ä¾¡ã™ã‚‹æ–‡å­—
    1. ã€Aï¼šaã€‘ASCIIæ–‡å­—ã®å¤§æ–‡å­—ãƒ»å°æ–‡å­—
    2. ã€ã¯ï¼šãƒã€‘ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠ
    3. ã€ã‚ˆï¼šã‚‡ã€‘æ—¥æœ¬èªã®å¤§æ–‡å­—ã¨å°æ–‡å­—
    4. ã€ã¯ï¼šã±ï¼šã°ã€‘æ¸…éŸ³ãƒ»æ¿éŸ³ãƒ»åŠæ¿éŸ³
    5. ã€ãƒï¼šï¾Šã€‘å…¨è§’ãƒ»åŠè§’
    6. ã€ğŸ£ï¼šğŸºã€‘ä»»æ„ã®çµµæ–‡å­—

```
+---+----------------------+-------------------+--------------------+------------------------+--------------------+-------------+--------|
| # | Case                 | Sample Characters | utf8mb4_unicode_ci | utf8mb4_unicode_520_ci | utf8mb4_general_ci | utf8mb4_bin | EXPECT |
+---+----------------------+-------------------+--------------------+------------------------+--------------------+-------------+--------|
| 1 | ASCII Upper/Lower    | A, a              | CI (good)          | CI (good)              | CI (good)          | CS (unkind) | CI     |
| 2 | Hiragana-Katakana    | ã¯, ãƒ            | CI (good)          | CI (good)              | CS (unkind)        | CS (unkind) | CI     |
| 3 | Japanese Upper/Lower | ã‚ˆ, ã‚‡            | CI (buggy)         | CI (buggy)             | CS (good)          | CS (good)   | CS     |
| 4 | Seion-(Han-)Dakuon   | ã¯, ã°, ã±        | CI (buggy)         | CI (buggy)             | CS (good)          | CS (good)   | CS     |
| 5 | Wide-Narrow          | ãƒ, ï¾Š, ï¼­ï½™, My   | CI (good)          | CI (good)              | CS (unkind)        | CS (unkind) | CI     |
| 6 | Emoji                | ğŸ£, ğŸº            | CI (buggy)         | CS (good)              | CI (buggy)         | CS (good)   | CS     |
+---+----------------------+-------------------+--------------------+------------------------+--------------------+-------------+--------|
```

- ã€Œãƒãƒã€ã¨ã€Œãƒ‘ãƒ‘ã€ã‚’åŒä¸€è¦–ã—ã¦ã—ã¾ã†ã¨ã„ã£ãŸ Buggy ãªæŒ™å‹•ã‚’å«ã‚€ç…§åˆé †åºã‚’é™¤ãã¨ã€æ¡ç”¨ã™ã¹ãç…§åˆé †åºã¨ã—ã¦ã¯é¸æŠè‚¢ã« utf8mb4_bin ã—ã‹æ®‹ã‚‰ãªã„ã€‚
- çµµæ–‡å­—ã‚’ç„¡è¦–ã™ã‚Œã° utf8mb4_general_ci ã‚‚é¸æŠè‚¢ã«æ®‹ã‚‹ã€‚

ã“ã®ä»¶ã«ã¤ã„ã¦ã¯ [MySQL Bugs: #79977: utf8mb4_unicode_520_ci don't make sense for Japanese FTS](https://bugs.mysql.com/bug.php?id=79977) ã§æœŸå¾…ã™ã‚‹ç…§åˆé †åºã®å®Ÿè£…ã®è¦æœ›ãŒæ‰±ã‚ã‚Œã¦ãŠã‚Šã€utf8mb4_ja_0900_as_cs ãŒ MySQL 8.0.1 ã§è¿½åŠ ã•ã‚Œã‚‹äºˆå®šã§ã‚ã‚‹ãŒã€ä½¿ç”¨ã™ã‚‹å ´åˆã¯ `ja_0900_as_cs` ã¨ã„ã†åç§°ã«é–¢ã—ã¦ä½•ãŒ CS ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã‹ï¼ˆASCII Upper/Lower ã¯åŒºåˆ¥ã•ã‚Œã‚‹ã®ã‹ï¼‰ã«ã¤ã„ã¦ã€æœŸå¾…ã™ã‚‹çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã‹ã‚’ãã¡ã‚“ã¨ç¢ºèªã—ãŸæ–¹ãŒã‚ˆã•ãã†ã§ã‚ã‚‹ã€‚ï¼ˆå‚ç…§ï¼š[æ—¥ã€…ã®è¦šæ›¸: MySQL 8.0.1ã§utf8mb4_ja_0900_as_csãŒå°å…¥ã•ã‚ŒãŸ](https://yoku0825.blogspot.jp/2017/04/mysql-801utf8mb4ja0900ascs.html)ï¼‰

## æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦

MySQL ã® Charset ã«ã¯æ¬¡ã®ç¨®é¡ãŒã‚ã‚‹ã€‚

- ã‚µãƒ¼ãƒ
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- ã‚µãƒ¼ãƒã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–“ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- ãƒ†ãƒ¼ãƒ–ãƒ«
- ã‚«ãƒ©ãƒ 

ãªãŠã€my.cnf ã«ãŠã‘ã‚‹å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ„å‘³ã¯æ¬¡ã®é€šã‚Šã€‚

- `[mysqld]`ï¼šMySQL Daemonï¼ˆã‚µãƒ¼ãƒå´ï¼‰ãŒå‚ç…§ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `[client]`ï¼šMySQL æ¥ç¶šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå‚ç…§ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `[mysql]`ï¼šMySQL ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã® mysql ãŒå‚ç…§ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³

MySQL è‡ªä½“ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’ç¢ºèªã™ã‚‹å ´åˆã¯ã€SHOW VARIABLES ã‚’å®Ÿè¡Œã™ã‚Œã°ã‚ˆã„ã€‚

```
mysql> SHOW VARIABLES LIKE 'char%';
```

å„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’ç¢ºèªã™ã‚‹å ´åˆã¯ã€`information_schema` ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã® `schemata`, `tables`, `columns` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ `SELECT` ã§å‚ç…§ã™ã‚Œã°ã‚ˆã„ã€‚

```
mysql> SELECT * FROM information_schema.schemata;
```

### (MySQL Charset) ã‚µãƒ¼ãƒ

æ–°è¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® Charset ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

- mysqld ã®èµ·å‹•æ™‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ `--character-set-server=utf8mb4`
- my.cnf ã® [mysqld] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ `character-set-server = utf8mb4`
- ã‚µãƒ¼ãƒå¤‰æ•° `character_set_server`

my.cnf ã§è¨­å®šã™ã‚‹å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚Œã°ã‚ˆã„ã€‚

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 10.1.5 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ–‡å­—ã‚»ãƒƒãƒˆãŠã‚ˆã³ç…§åˆé †åºã®æ§‹æˆ](https://dev.mysql.com/doc/refman/5.6/ja/charset-applications.html)

```
[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_bin
```

æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®šã«ãŠã‘ã‚‹ã©ã®é …ç›®ã«ãŠã„ã¦ã‚‚ã€Charset ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãŒ Collation ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã«ã¯ã€Collation ã«ã¯æŒ‡å®šã—ãŸ Charset ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ã‚ã‚Œã‚‹ç‚¹ã«æ³¨æ„ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚utf8mb4 ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® Collation ã¯ MySQL 5.7 æ™‚ç‚¹ã§ utf8mb4_general_ci ã§ã‚ã‚‹ï¼ˆ`mysql> SHOW CHARACTER SET;` ã§ç¢ºèªã§ãã‚‹ï¼‰ã€‚

ä¾‹ãˆã°ã€`character-set-server=utf8mb4` ãŠã‚ˆã³ `collation-server=utf8mb4_bin` ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã§ã‚‚ã€`CREATE DATABASE db_name CHARSET utf8mb4;` ã®ã‚ˆã†ã« Collation ã‚’çœç•¥ã—ãŸå ´åˆã€`collation-server=utf8mb4_bin` ã®è¨­å®šã¯ç„¡è¦–ã•ã‚Œã‚‹ã€‚

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 10.1.3.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ–‡å­—ã‚»ãƒƒãƒˆãŠã‚ˆã³ç…§åˆé †åº](https://dev.mysql.com/doc/refman/5.6/ja/charset-database.html)

> MySQL ã§ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ–‡å­—ã‚»ãƒƒãƒˆã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç…§åˆé †åºãŒæ¬¡ã®ã‚ˆã†ã«é¸æŠã•ã‚Œã¾ã™ã€‚
> - CHARACTER SET X ã¨ COLLATE Y ã®ä¸¡æ–¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ–‡å­—ã‚»ãƒƒãƒˆ X ã¨ç…§åˆé †åº Y ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
> - CHARACTER SET X ã¯æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãŒ COLLATE ã¯æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€æ–‡å­—ã‚»ãƒƒãƒˆ X ã¨ãã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç…§åˆé †åºãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚å„æ–‡å­—ã‚»ãƒƒãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç…§åˆé †åºã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€SHOW COLLATION ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
> - COLLATE Y ã¯æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ãŒ CHARACTER SET ã¯æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€Y ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸæ–‡å­—ã‚»ãƒƒãƒˆã¨ç…§åˆé †åº Y ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
> - ã“ã‚Œä»¥å¤–ã®å ´åˆã¯ã€ã‚µãƒ¼ãƒãƒ¼æ–‡å­—ã‚»ãƒƒãƒˆã¨ã‚µãƒ¼ãƒãƒ¼ç…§åˆé †åºãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### (MySQL Charset) ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®è¨­å®šå€¤ã§ã‚ã‚Šã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã€‚ã¾ãŸã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚µãƒ¼ãƒã«ã“ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã€ã‚µãƒ¼ãƒã¯ãã‚Œã‚‰ã‚’ character_set_clientã€character_set_resultsã€ãŠã‚ˆã³ character_set_connection ã«è¨­å®šã—ã‚ˆã†ã¨ã™ã‚‹ã€‚

- mysql ã®æ¥ç¶šæ™‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ `--defaultcharacter-set=utf8mb4`
- my.cnf ã® [client] ã‚»ã‚¯ã‚·ãƒ§ãƒ³ `default-character-set = utf8mb4`
- æœªæŒ‡å®šã®å ´åˆã¯ latin1

my.cnf ã§è¨­å®šã™ã‚‹å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚Œã°ã‚ˆã„ã€‚

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 10.1.4 æ¥ç¶šæ–‡å­—ã‚»ãƒƒãƒˆãŠã‚ˆã³ç…§åˆé †åº](https://dev.mysql.com/doc/refman/5.6/ja/charset-connection.html)
    - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ `[mysql]` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æ›¸ã„ã¦ã„ã‚‹ãŒ `[client]` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æ›¸ã„ã¦ã‚‚ mysql ã‚³ãƒãƒ³ãƒ‰ã¯å‚ç…§ã§ãã‚‹ã€‚
    - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ `[client]` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã§ãã‚‹ã¨ã¯é™ã‚‰ãªã„ã€‚

```
[client]
default-character-set = utf8mb4
```

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 4.2.5 ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¿®é£¾å­](https://dev.mysql.com/doc/refman/5.6/ja/option-modifiers.html)
    - ç‰¹ã« `[client]` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãŠã„ã¦ã€è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è§£é‡ˆã§ããªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæœªçŸ¥ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¸æ­£ãªè¨˜è¿°ã¨è§£é‡ˆã—ã¦å‡¦ç†ã‚’æ­¢ã‚ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã€‚ãã®ã‚ˆã†ãªå ´åˆã«ã¯ `loose-` æ¥é ­è¾ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§å›é¿ã§ãã‚‹ã€‚

```
[client]
loose-default-character-set = utf8mb4
```

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 10.1.4 æ¥ç¶šæ–‡å­—ã‚»ãƒƒãƒˆãŠã‚ˆã³ç…§åˆé †åº](https://dev.mysql.com/doc/refman/5.6/ja/charset-connection.html)

> ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹ã¨ãã«ã€ä½¿ç”¨ã™ã‚‹æ–‡å­—ã‚»ãƒƒãƒˆã®åå‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¯ã“ã®åå‰ã‚’ä½¿ç”¨ã—ã¦ã€character_set_clientã€character_set_resultsã€ãŠã‚ˆã³ character_set_connection ã‚·ã‚¹ãƒ†ãƒ å¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚å®Ÿéš›ã«ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã¯æ–‡å­—ã‚»ãƒƒãƒˆåã‚’ä½¿ç”¨ã—ã¦ SET NAMES æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ 

### (MySQL Charset) ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³

ã‚µãƒ¼ãƒå´ã§ `skip-character-set-client-handshake` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯ã€character_set_connection ã«é–¢ã—ã¦ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸæ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ç„¡è¦–ã™ã‚‹ã€‚

`skip-character-set-client-handshake` ã®è¨­å®šã¯ MySQL 4.0 ã®æŒ™å‹•ã«æˆ»ã—ãŸã„å ´åˆã«ä½¿ã†ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ã€ç‰¹åˆ¥ãªç†ç”±ãŒãªã„é™ã‚Šã¯ã“ã®è¨­å®šã‚’è¡Œã†ã¹ãã§ã¯ãªã„ã€‚ï¼ˆå‚ç…§ï¼š[MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: A.11 MySQL 5.6 FAQ: MySQL ã®ä¸­å›½èªã€æ—¥æœ¬èªã€ãŠã‚ˆã³éŸ“å›½èªã®æ–‡å­—ã‚»ãƒƒãƒˆ](https://dev.mysql.com/doc/refman/5.6/ja/faqs-cjk.html#faq-cjk-how-use-4-0-charset)ï¼‰

### (MySQL Charset) ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

ãã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã® Charset ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 13.1.10 CREATE DATABASE æ§‹æ–‡](https://dev.mysql.com/doc/refman/5.6/ja/create-database.html)
- ä½œæˆï¼š`CREATE DATABASE db_name CHARSET utf8mb4 COLLATE utf8mb4_bin;`
- ç¢ºèªï¼š`SHOW CREATE DATABASE db_name;`
- å¤‰æ›´ï¼š`ALTER DATABASE db_name CHARSET utf8mb4 COLLATE utf8mb4_bin;`

### (MySQL Charset) ãƒ†ãƒ¼ãƒ–ãƒ«

ãã®ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã®æ–°è¦ã‚«ãƒ©ãƒ ã® Charset ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã€‚

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 13.1.17 CREATE TABLE æ§‹æ–‡](https://dev.mysql.com/doc/refman/5.6/ja/create-table.html)
- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 13.1.7 ALTER TABLE æ§‹æ–‡](https://dev.mysql.com/doc/refman/5.6/ja/alter-table.html)
- ä½œæˆï¼š`CREATE TABLE tbl_name (...) CHARSET utf8mb4 COLLATE utf8mb4_bin;`
- ç¢ºèªï¼š`SHOW CREATE TABLE tbl_name;`
- å¤‰æ›´ï¼š`ALTER TABLE tbl_name CHARSET utf8mb4 COLLATE utf8mb4_bin;`
- æ—¢å­˜ã‚«ãƒ©ãƒ ã®å¤‰æ›ï¼š`ALTER TABLE tbl_name CONVERT TO CHARSET utf8mb4 COLLATE utf8mb4_bin;`

### (MySQL Charset) ã‚«ãƒ©ãƒ 

è‡ªèº«ã®ã‚«ãƒ©ãƒ ã® Charset ã§ã‚ã‚‹ã€‚

- [MySQL :: MySQL 5.6 ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒãƒ‹ãƒ¥ã‚¢ãƒ« :: 13.1.17 CREATE TABLE æ§‹æ–‡](https://dev.mysql.com/doc/refman/5.6/ja/create-table.html)
- ä½œæˆï¼š`CREATE TABLE tbl_name (col_name VARCHAR(64) CHARSET utf8mb4 COLLATE utf8mb4_bin, ...);`
- ç¢ºèªï¼š`SHOW CREATE TABLE tbl_name;`
- å¤‰æ›´ï¼š`ALTER TABLE tbl_name MODIFY col_name VARCHAR(64) CHARSET utf8mb4 COLLATE utf8mb4_bin;`